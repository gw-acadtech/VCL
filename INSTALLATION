Installing VCL 2.1

Contents:

  I. Web (frontend)
 II. Database (MySQL)
III. Management Node (backend)
 IV. Adding extra local accounts
  V. Adding LDAP authentication

I. Web (frontend)

Prerequisites:
Your web server should meet the following criteria before installing the VCL Frontend Code:

   * Apache HTTP Server v1.3 or v2.x with SSL enabled - while VCL may run under another webserver capable of running PHP code, it has only been tested to work with Apache HTTP Server
   * PHP 5
   * php modules that should be installed (depending on your Linux distro, some of these may be compiled in to php instead of being a separate module):
      - php-gd
      - php-json
      - php-mcrypt
      - php-mysql
      - php-openssl
      - php-sysvsem
      - php-xml
      - php-xmlrpc
   * useful to have the server set up to be able to send debugging emails
   * php-mcrypt requires libmcrypt and mcrypt libraries as dependencies. These may need to be installed first.

Installation:

1. move the web directory somewhere that your web server can access it (you'll probably also want to rename it to 'vcl')

   ex: mv web /var/www/html/vcl

2. modify vcl/.ht-inc/secrets.php
   * set $vclhost, $vcldb, $vclusername, and $vclpassword to match your database setup
   * create random passwords for $mcryptkey, $mcryptiv, and $pemkey - $mcryptiv must be 8 hex characters

3. run the genkeys.sh script from within vcl/.ht-inc and give it $pemkey from secrets.php as the passphrase (3 times, copy/paste is a good idea here)

4. modify vcl/.ht-inc/conf.php to match your site - COOKIEDOMAIN needs to be the domain name your web server is using, or left blank if you are accessing it by IP only

5. *NOTICE* JpGraph 2.x is no longer available. JpGraph 3.x is released under a dual license. QPL 1.0 (Qt Free Licensee). Free for non-commercial, open-source or educational use (JpGraph Professional License for commercial use). If you are planning to use this for commercial use and don't want to pay for JpGraph, you can safely skip this step with the only side effect of not being able to display a few graphs on the statistics page.
   Download JpGraph from http://www.aditus.nu/jpgraph/jpdownload.php
   * For PHP5, download the 3.x series, extract it, and copy the src directory from it to vcl/.ht-inc/jpgraph

6. download version 0.4.0 of Dojo Toolkit: http://download.dojotoolkit.org/release-0.4.0/dojo-0.4.0-ajax.tar.gz
   * extract it under the vcl directory and rename "dojo-0.4.0-ajax" to "dojoAjax"

7. download version 1.1.0 of Dojo Toolkit: http://download.dojotoolkit.org/release-1.1.0/dojo-release-1.1.0.tar.gz
   * extract it under the vcl directory and rename "dojo-release-1.1.0" to "dojo"

8. go into the themes directory (vcl/themes) and run "./copydojocss.sh default" to copy parts of dojo's css into the "default" theme

9. if you want to be able to edit any of the documentation that comes bundled with the vcl web code, download fckeditor from http://www.fckeditor.net/download (most people can skip this step)
       * extract it under the vcl directory

10. open a browser and open the testsetup.php page
       * i.e. if you set up your site to be https://my.server.org/vcl/ open https://my.server.org/vcl/testsetup.php

11. debug any issues reported by testsetup.php

12. now, open the index.php page in your browser

13. select Local Account and use 'admin' as the user and 'adminVc1passw0rd' as the password

14. click the "Management Nodes" link

15. enter the hostname and IP of your management node

16. click Add

17. fill in "Install Path" - this is parent directory under which image files will be stored

18. click "Confirm Management Node"

19. click Submit

20. click the "Management Nodes" link

21. select "Edit Management Node Grouping"

22. click Submit

23. select the checkbox for your management node

24. click Submit

25. click "Manage Computers"

26. select the "Add Single Computer" radio button

27. click the Submit

28. fill in Hostname, IP Address, owner (admin@Local), RAM, Proc Speed, Network Speed, select "blade" for Type, select "xCAT 1.x Provisioning" for "Provisioning Engine", and click the checkbox under "allcomputers", and "newimages"
       Note: if using using vmware, select "virtualmachine" for Type and "VMWare Server Provisioning" for "Provisioning Engine"

29. click Confirm Computer

30. click Submit (don't worry about the fact that the computer you just added isn't listed after clicking Submit)

31. after you've configured your image library and your management node has started checking in, you should be able to make a reservation



II. Database (MySQL)

Prerequisites:
MySQL 5 installed and running

Installation:

1.  create a database in mysql named for use with VCL

   CREATE DATABASE vcl;

2. create a user with SELECT, INSERT, UPDATE, and DELETE privileges on the database you just created

   ** NOTE: Replace vcluserpassword with your own password!

   GRANT SELECT,INSERT,UPDATE,DELETE ON vcl.* TO 'vcluser'@'localhost' IDENTIFIED BY 'vcluserpassword';

3. import vcl.sql file into database

   mysql vcl < vcl.sql



III. Management Node (backend)



IV. Adding extra local accounts

There's not currently a tool for this.  You will need to add entries directly to the database.
1) add entry to user table
INSERT INTO user (unityid, firstname, lastname, email, lastupdated) VALUES ('myusername', 'myfirstname', 'mylastname', 'myemailaddr', NOW());
2) find out the id generated for that user
SELECT id, unityid FROM user WHERE unityid = 'myusername';
3) add entry to the localauth table
INSERT INTO localauth (userid, salt, passhash, lastupdated) VALUES ('place1', 'place2', 'place3', NOW())
with place1 = id from step 2
     place2 = an 8 char random string
     place3 = sha1sum( desired password with place2 stuck on the end )
              this can be generated under linux like this (using 'thedog' as the password and 11111111 as place2):
                 echo -n 'thedog11111111' | sha1sum
Once a user has been added, the user can go to User Preferences to change his/her password



V. Adding LDAP authentication

1) fill in the necessary information in vcl/.ht-inc/conf.php
2) add an entry to the affiliation table and use the id for that entry as 'affiliationid' for your new entry in vcl/.ht-inc/conf.php
3) uncomment the 'require_once(".ht-inc/authmethods/ldapauth.php");' line in in vcl/.ht-inc/conf.php





___________________________________________________________
prerequisites:
for single server environment.
Linux Host - tested RH Enterprise/Advanced Server 4
 - apache httpd with SSL configured
 - mysql 5.X with SSL configured
 - PHP 5.X with php-mcrypt module
 - Perl 5.8

 - DHCP (The dhcp service is should be running on a private network.
   This is needed to statically assign addresses to the machines.)
        
         
 NOTE: from the redhat install CD it's easiest to select the install everything
 option. With RH package selection, select "Custom", then scroll down to
 the bottom and select "Everything".

 If using xCAT <xcat.org>
 - see install documentation http://xcat.org/doc

VCL is orginally developed in a blade environment using IBM blades and
xcat.
 
The blade configuration is using:
BladeCenter chassis
two network Layer 2/3 Copper GigE switch modules
HS21 blades

The blades have two network adapters, eth0,eth1
eth0 ideally should be on private network so as to not allow pxe booting
on public or internal campus network.
 
In a single blade chassis environment a public switch is needed. For
multiple chassis's two switches are needed:
one public
one for interconnecting chassis on private network.

******* WARNING *********
Detailed documentation is still in progress, the below steps should be enough to
get started.
************************



Management node - vcld
28) To install the perl code extract the vcl.tar.gz , any
location should be fine (/usr/local/, /root, ... etc)
29) cd to the lib directory /PATH/vcl/lib/VCL
30) copy configuration directory file to /etc: cp -r <PATH>/vcl/etc/vcl /etc
31) modify /etc/vcl/vcld.conf
    at a minimum you'll need to add the database information:
    database,server,User,user's password
32) Modify the startup script. S99vcld.linux to include the installation
path.
33) run the S99vcld.linux script i.e. S99vcld.linux start
34) drivers for loading Windows images onto different hardware than they were created on can be extracted under the Drivers directory of each Sysprep type under the tools directory


Image creation:
The images listed in the VCL menu are only placeholders.
Images/Environments need to be created.
For information on creating images, please visit:
http://vcl.ncsu.edu/node/16
